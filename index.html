<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>ðŸ”´ LIVE CRICKET STREAMING</title>
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* [Previous CSS styles remain exactly the same] */
        /* Add this new style for stream selector */
        .stream-selector {
            margin: 15px 0;
            text-align: center;
        }
        
        .stream-btn {
            background: linear-gradient(45deg, var(--neon-purple), var(--neon-pink));
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(148, 0, 211, 0.5);
        }
        
        .stream-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(148, 0, 211, 0.8);
        }
        
        .stream-btn.active {
            background: linear-gradient(45deg, var(--neon-green), var(--neon-blue));
            box-shadow: 0 0 20px rgba(0, 255, 127, 0.8);
        }
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same until before the scripts] -->

    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-quality-levels/2.1.0/videojs-contrib-quality-levels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-hls-quality-selector/1.1.4/videojs-hls-quality-selector.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const config = {
                streams: [
                    {
                        name: "Primary Stream",
                        url: 'https://ee4ee8c03a26.eu-central-1.playback.live-video.net/api/video/v1/eu-central-1.755921704393.channel.LOohfipmCQDP.m3u8',
                        active: true
                    },
                    {
                        name: "Backup Stream 1",
                        url: 'https://v18tataplaysyndication.akamaized.net/bpk-tv/StarSports_2_Hin_HD_voot_MOB/output03/hdntl=exp=1744631889~acl=%2f*~data=hdntl~hmac=6ccd2c67d51f4f07c078a9f2145449815fe1a047dfc72d38cc1f29121d6f42b9/StarSports_2_Hin_HD_voot_MOB-audio_108038_hin=108000-video=1275600.m3u8',
                        active: false
                    }
                ],
                autoPlay: true,
                maxRetries: 3,
                retryDelay: 3000
            };

            // Create stream selector buttons
            const streamSelector = document.createElement('div');
            streamSelector.className = 'stream-selector';
            
            config.streams.forEach((stream, index) => {
                const btn = document.createElement('button');
                btn.className = `stream-btn ${stream.active ? 'active' : ''}`;
                btn.textContent = stream.name;
                btn.onclick = () => switchStream(index);
                streamSelector.appendChild(btn);
            });
            
            document.querySelector('.main-container').insertBefore(streamSelector, document.querySelector('.video-container'));

            // Initialize player
            const player = videojs('cricket-stream', {
                fluid: true,
                responsive: true,
                liveui: true,
                autoplay: config.autoPlay ? 'muted' : false,
                controlBar: {
                    children: [
                        'playToggle',
                        'volumePanel',
                        'currentTimeDisplay',
                        'timeDivider',
                        'durationDisplay',
                        'progressControl',
                        'liveDisplay',
                        'remainingTimeDisplay',
                        'customControlSpacer',
                        'playbackRateMenuButton',
                        'qualitySelector',
                        'fullscreenToggle'
                    ]
                }
            });

            // Remove big play button
            player.bigPlayButton.hide();
            
            let currentStreamIndex = config.streams.findIndex(s => s.active);
            let retryCount = 0;

            // Function to switch streams
            function switchStream(index) {
                if (index === currentStreamIndex) return;
                
                // Update UI
                document.querySelectorAll('.stream-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.stream-btn')[index].classList.add('active');
                
                currentStreamIndex = index;
                retryCount = 0;
                loadStream();
            }

            // Function to load current stream
            function loadStream() {
                showLoading();
                const stream = config.streams[currentStreamIndex];
                
                player.src({
                    src: stream.url,
                    type: 'application/x-mpegURL',
                    withCredentials: false
                });

                player.ready(() => {
                    player.play().catch(e => {
                        console.error("Autoplay failed:", e);
                        showError("Autoplay was prevented. Please click the play button.");
                    });
                });
            }

            // Initial stream load
            loadStream();

            // Enable quality selector
            player.ready(() => {
                if (player.tech_.sourceHandler_ && player.tech_.sourceHandler_.name === 'hls') {
                    player.hlsQualitySelector = player.hlsQualitySelector({
                        displayCurrentQuality: true,
                        placementIndex: 1,
                        vjsIconClass: 'vjs-icon-cog'
                    });
                }
                
                // Add unmute button
                const unmuteBtn = document.createElement('button');
                unmuteBtn.className = 'vjs-mute-control vjs-control vjs-button';
                unmuteBtn.innerHTML = '<span class="vjs-icon-placeholder"></span>';
                unmuteBtn.title = 'Unmute';
                unmuteBtn.addEventListener('click', () => {
                    player.muted(false);
                    unmuteBtn.remove();
                });
                document.querySelector('.vjs-volume-panel').after(unmuteBtn);
            });

            // Error handling with retries
            player.on('error', () => {
                if (retryCount < config.maxRetries) {
                    retryCount++;
                    showError(`Connection lost. Retrying (${retryCount}/${config.maxRetries})...`);
                    
                    setTimeout(() => {
                        loadStream();
                    }, config.retryDelay);
                } else {
                    // Try next available stream
                    const nextIndex = (currentStreamIndex + 1) % config.streams.length;
                    if (nextIndex !== currentStreamIndex) {
                        switchStream(nextIndex);
                    } else {
                        showError("All streams failed. Please try again later.");
                    }
                }
            });

            player.on('playing', () => {
                hideError();
                hideLoading();
                document.getElementById('connection-status').innerHTML = 
                    '<i class="fas fa-circle" style="color: #0f0;"></i> Stable Connection';
            });

            player.on('waiting', () => {
                document.getElementById('connection-status').innerHTML = 
                    '<i class="fas fa-circle" style="color: #ff0;"></i> Buffering...';
            });

            // [Rest of your existing JavaScript remains the same]
            
            /* Helper functions (you should already have these) */
            function showError(message) {
                const errorMsg = document.getElementById('error-message');
                const errorDetails = document.getElementById('error-details');
                errorDetails.textContent = message;
                errorMsg.style.display = 'block';
                document.getElementById('loading-spinner').style.display = 'none';
            }
            
            function hideError() {
                document.getElementById('error-message').style.display = 'none';
            }
            
            function showLoading() {
                document.getElementById('loading-spinner').style.display = 'block';
                hideError();
            }
            
            function hideLoading() {
                document.getElementById('loading-spinner').style.display = 'none';
            }
        });
    </script>
</body>
</html>
